{% extends "base.html" %}
{% block title %}Boutique {{ boutique.nom }}{% endblock %}
{% block content %}
<h1 class="text-2xl font-bold mb-4">{{ boutique.nom }}</h1>

<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
    <div class="bg-white rounded shadow p-4">
        <p class="text-sm text-gray-500">Gérant</p>
        <p class="font-semibold">{{ boutique.gerant or '-' }}</p>
        <p class="text-sm text-gray-500 mt-2">Email : {{ boutique.email }}</p>
        <p class="text-sm text-gray-500">Téléphone : {{ boutique.telephone or '-' }}</p>

        <!-- Statut + formulaire de changement -->
        <div class="mt-4">
            <p class="text-sm text-gray-500 mb-1">Statut actuel</p>
            <span
                class="inline-flex items-center px-2 py-1 rounded-full text-xs font-semibold
                {% if boutique.statut.value == 'ACTIF' %}
                    bg-green-100 text-green-700
                {% elif boutique.statut.value == 'INACTIF' %}
                    bg-yellow-100 text-yellow-700
                {% elif boutique.statut.value == 'SUSPENDU' %}
                    bg-red-100 text-red-700
                {% else %}
                    bg-gray-100 text-gray-700
                {% endif %}
            ">
                {{ boutique.statut.value }}
            </span>

            <form action="/admin/boutiques/{{ boutique.id }}/statut" method="post" class="mt-3 space-y-2">
                <label class="block text-sm font-medium">Modifier le statut</label>
                <select name="statut" class="border rounded px-2 py-1 text-sm">
                    <option value="ACTIF" {% if boutique.statut.value == 'ACTIF' %}selected{% endif %}>ACTIF</option>
                    <option value="INACTIF" {% if boutique.statut.value == 'INACTIF' %}selected{% endif %}>INACTIF</option>
                    <option value="SUSPENDU" {% if boutique.statut.value == 'SUSPENDU' %}selected{% endif %}>SUSPENDU</option>
                </select>
                <button type="submit"
                        class="inline-block bg-blue-600 text-white text-xs px-3 py-1 rounded hover:bg-blue-700">
                    Mettre à jour
                </button>
            </form>
        </div>
    </div>

    <div class="bg-white rounded shadow p-4">
        <p class="text-sm text-gray-500">CA total</p>
        <p class="text-2xl font-bold">{{ '%.2f'|format(total_ca) }} €</p>
        <p class="text-sm text-gray-500 mt-2">Nombre de devis : {{ nb_devis }}</p>
    </div>
    <div class="bg-white rounded shadow p-4">
        <p class="text-sm text-gray-500">Taux d'acceptation</p>
        <p class="text-2xl font-bold">{{ '%.1f'|format(taux_acceptation) }} %</p>
        <p class="text-sm text-gray-500 mt-2">Devis acceptés : {{ nb_acceptes }}</p>
    </div>
</div>

<h2 class="text-xl font-semibold mb-2">Devis de la boutique</h2>
<div class="bg-white rounded shadow overflow-hidden">
    <table class="min-w-full text-sm">
        <thead class="bg-gray-50">
        <tr>
            <th class="px-4 py-2 text-left">Référence</th>
            <th class="px-4 py-2 text-left">Date</th>
            <th class="px-4 py-2 text-left">Statut</th>
            <th class="px-4 py-2 text-left">Montant</th>
        </tr>
        </thead>
        <tbody>
        {% for d in devis %}
            <tr class="border-t">
                <td class="px-4 py-2">{{ boutique.nom }}-#{{ d.numero_boutique }}</td>
                <td class="px-4 py-2">{{ d.date_creation.strftime('%Y-%m-%d') if d.date_creation else '' }}</td>
                <td class="px-4 py-2">{{ d.statut.value }}</td>
                <td class="px-4 py-2">{{ '%.2f'|format(d.prix_total) }} €</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
